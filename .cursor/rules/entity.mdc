---
globs: src/modules/**/entities/*.ts
---

# Entity Guidelines

## Structure & Naming

**Directory:** `module/entities/[entity-name].entity.ts`  
**Class:** `[EntityName]Entity` (e.g., `UserEntity`)  
**Table:** Singular lowercase (e.g., `users`)

## Required Standard Fields

Every entity **must** include these exact fields:

```typescript
@PrimaryGeneratedColumn()
id: number;  // ❗ Always number, never UUID/string

@CreateDateColumn({ name: 'created_at' })
createdAt: Date;

@UpdateDateColumn({ name: 'updated_at' })
updatedAt: Date;

@DeleteDateColumn({ name: 'deleted_at' })
deletedAt: Date | null;
```

## Best Practices

1. Use `@Entity('table_name')` with explicit table name
2. Column names in snake_case: `@Column({ name: 'field_name', nullable: false })`
3. Soft deletes with `@DeleteDateColumn`
4. Field order: id → business fields → audit fields
5. No business logic in entities

## Examples

### Basic Entity

```typescript
@Entity('users')
export class UserEntity {
  @PrimaryGeneratedColumn()
  id: number;

  @Column({ name: 'email', nullable: false })
  email: string;

  @CreateDateColumn({ name: 'created_at' })
  createdAt: Date;

  @UpdateDateColumn({ name: 'updated_at' })
  updatedAt: Date;

  @DeleteDateColumn({ name: 'deleted_at' })
  deletedAt: Date | null;
}
```

### With Relationship (ManyToOne)

```typescript
@Entity('posts')
export class PostEntity {
  @PrimaryGeneratedColumn()
  id: number;

  @Column({ name: 'user_id', nullable: false })
  userId: number;

  @ManyToOne(() => UserEntity)
  @JoinColumn({ name: 'user_id' })
  user: UserEntity;

  // ... standard audit fields
}
```

### Many-to-Many (Explicit Join Entity)

Always create separate join entity instead of automatic join table:

```typescript
@Entity('user_roles')
export class UserRoleEntity {
  @PrimaryGeneratedColumn()
  id: number;

  @Column({ name: 'user_id', nullable: false })
  userId: number;

  @Column({ name: 'role_id', nullable: false })
  roleId: number;

  @ManyToOne(() => UserEntity)
  @JoinColumn({ name: 'user_id' })
  user: UserEntity;

  @ManyToOne(() => RoleEntity)
  @JoinColumn({ name: 'role_id' })
  role: RoleEntity;

  // ... standard audit fields
}
```

Reference from parent entity:

```typescript
@OneToMany(() => UserRoleEntity, (userRole) => userRole.user)
userRoles: UserRoleEntity[];
```

## Column Types Reference

```typescript
// String
@Column({ name: 'title', nullable: false })
title: string;

// Text (long)
@Column({ name: 'content', type: 'text' })
content: string;

// Number
@Column({ name: 'price', type: 'decimal', precision: 10, scale: 2 })
price: number;

// Boolean
@Column({ name: 'is_active', type: 'boolean', default: true })
isActive: boolean;

// Date
@Column({ name: 'published_at', type: 'timestamp', nullable: true })
publishedAt: Date | null;
```

## Entity Registration

```typescript
@Module({
  imports: [TypeOrmModule.forFeature([UserEntity])],
})
export class UserModule {}
```

## ❌ Common Mistakes

```typescript
// ❌ Missing standard fields, wrong ID type, no column names
@Entity()
export class BadEntity {
  @PrimaryGeneratedColumn('uuid')
  id: string;

  @Column()
  name: string;
}

// ✅ Correct
@Entity('entities')
export class GoodEntity {
  @PrimaryGeneratedColumn()
  id: number;

  @Column({ name: 'name', nullable: false })
  name: string;

  @CreateDateColumn({ name: 'created_at' })
  createdAt: Date;

  @UpdateDateColumn({ name: 'updated_at' })
  updatedAt: Date;

  @DeleteDateColumn({ name: 'deleted_at' })
  deletedAt: Date | null;
}
```
